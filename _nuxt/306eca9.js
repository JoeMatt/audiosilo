(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{307:function(e,t,l){"use strict";l.r(t);var r=l(4),n=(l(44),l(298),l(308),l(311),l(34),l(80),l(48),l(312),l(137)),o=l(313),c={name:"Player",props:["details","server"],data:function(){return{editPlaybackSpeed:!1,player:null,soundid:null,playing:!1,loading:!1,localremaining:0,current:0}},computed:{image:function(){return this.$store.state.app.book.cover},groupDetails:function(){return this.$store.state.app.groupDetails},playbackSpeed:function(){return Number.parseFloat(this.groupDetails.playback_speed).toFixed(2)},transcode:function(){return this.$store.state.app.transcode},seek:function(){return this.$store.state.app.book.seek},hash:function(){return Object(n.sha256)(this.$route.fullPath)},totalTime:function(){var e=0;return this.details.files.forEach((function(t){e+=t.meta.duration})),e},remaining:function(){var e=this.totalTime-this.seek;return this.secondsToTime(e)+" remaining"},percent:function(){var e=(this.totalTime-this.seek)/this.totalTime*100;return 100-e.toFixed(0)},localpercent:function(){return 100-((this.details.files[this.currentfile.index].meta.duration-this.localseek)/this.details.files[this.currentfile.index].meta.duration*100).toFixed(0)},currentfile:function(){for(var e=0,i=0,t=this.details.files.length;i<t;i++){if(console.log(e+this.details.files[i].meta.duration),console.log("seek: "+this.seek),e+this.details.files[i].meta.duration>this.seek)return{index:i,start:e};e+=this.details.files[i].meta.duration}return{index:0,start:0}},localseek:function(){return(this.seek-this.currentfile.start).toFixed(0)}},mounted:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var l,r,n,c,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=e.server+"audio/"+e.details.files[e.currentfile.index].path+"?trans=h",r=null,n={hash:e.hash,file:e.server+"download/"+e.details.files[e.currentfile.index].path},t.next=5,e.$store.dispatch("app/fileIsCached",n);case 5:if(!t.sent){t.next=12;break}return t.next=9,e.$store.dispatch("app/getCachedFile",n);case 9:c=t.sent,l=c.src,r=c.format;case 12:e.player=new o.Howl({src:l,format:r,html5:!0}),e.localremaining=e.getLocalRemaining(),e.current=e.localseek,f=e,e.player.on("play",(function(){console.log("on play"),f.loading=!1,f.localremaining=f.getLocalRemaining()})).on("pause",(function(){console.log("on pause"),clearInterval(f.timer)})).on("load",(function(){console.log("on load")})).on("loaderror",(function(e,t){console.log("load error"),console.log(e),console.log(t)}));case 17:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.player&&this.player.unload(),clearInterval(this.timer)},methods:{getLocalRemaining:function(){if(!this.playing)return this.details.files[this.currentfile.index].meta.duration-this.localseek;var output=this.details.files[this.currentfile.index].meta.duration-this.player.seek();if(!0===this.playing){var e=this;setTimeout((function(){e.localremaining=e.getLocalRemaining(),e.current=e.player.seek()}),1e3)}return output},fullseek:function(e){return this.currentfile.start+e},extension:function(e){return/(?:\.([^.]+))?$/.exec(e)[1]},closePlayer:function(){this.$store.commit("app/player",!1)},togglePlay:function(){this.playing?this.pause():this.play()},secondsToTime:function(e){var t=e%3600;return Math.floor(e/3600)+"h"+Math.floor(t/60)+"m"},secondsToPlayback:function(e){var t=Math.floor(e/3600),l=e%3600,r=Math.floor(l/60),n=l%60,o=Math.ceil(n),output="";return t>0&&(output+=t+":"),output+String(r).padStart(2,"0")+":"+String(o).padStart(2,"0")},play:function(){this.loading=!0,console.log("play file"),console.log(this.localseek),null!==this.soundid?(this.player.seek(this.localseek,this.soundid),this.player.play(this.soundid)):(this.player.seek(this.localseek),this.soundid=this.player.play()),this.playing=!0},pause:function(){console.log("pause file"),this.player.pause(this.soundid),this.$store.dispatch("app/updateBookDetails",{hash:this.hash,book:{seek:this.fullseek(this.player.seek(null,this.soundid))}}),this.playing=!1},updatePlaybackSpeed:function(e){this.$store.commit("app/playbackSpeed",e.target.value)},increasePlaybackSpeed:function(){var e=parseFloat(this.playbackSpeed)+parseFloat("0.05");this.$store.commit("app/playbackSpeed",e.toFixed(2)),this.player.rate(e.toFixed(2))},decreasePlaybackSpeed:function(){var e=parseFloat(this.playbackSpeed)-parseFloat("0.05");this.$store.commit("app/playbackSpeed",e.toFixed(2)),this.player.rate(e.toFixed(2))},seekForwards:function(){var e=this.player.pause()._sounds[0]._seek,t=e+parseInt(this.groupDetails.seekForwards);t>=this.player.duration()||(console.log("skipping to "+t+" from "+e),this.player.seek(t),this.player.play())},seekBackwards:function(){var e=this.player.pause()._sounds[0]._seek,t=e-parseInt(this.groupDetails.seekBackwards);t<=0&&(t=0),console.log("skipping to "+t+" from "+e),this.player.seek(t),this.player.play()}}},f=l(52),component=Object(f.a)(c,(function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"flex flex-col justify-between relative h-screen overflow-auto"},[l("div",{staticClass:"absolute top-0 right-0 bg-gray-200 w-8 h-8 rounded-bl flex cursor-pointer justify-center items-center",on:{click:e.closePlayer}},[l("i",{staticClass:"fa-thin fa-chevron-down"})]),e._v(" "),l("div",[l("div",{staticClass:"text p-8 pb-5 flex justify-center flex-shrink"},[l("img",{staticClass:"block shadow rounded-md",attrs:{src:e.image}})]),e._v(" "),l("div",{staticClass:"w-full px-8 flex flex-col text-center items-center"},[l("div",{staticClass:"text-xl font-semibold flex mb-2"},[e._v("Chapter 1")]),e._v(" "),l("div",{staticClass:"text-sm text-gray-400 mb-2"},[e._v(e._s(e.details.files[0].name)+" - Artist name")]),e._v(" "),l("div",{staticClass:"flex w-full pt-1 items-center"},[l("div",{staticClass:"relative flex-grow mr-2"},[l("input",{staticClass:"shadow-none w-full flex flex-col text-center whitespace-nowrap text-white justify-center bg-purple-400",attrs:{type:"range"},domProps:{value:e.localpercent}})])]),e._v(" "),l("div",{staticClass:"flex w-full justify-between"},[l("div",{staticClass:"text-xs"},[e._v(e._s(e.secondsToPlayback(e.current)))]),e._v(" "),l("div",{staticClass:"px-8 text-xs"},[e._v(e._s(e.remaining))]),e._v(" "),l("div",{staticClass:"text-xs"},[e._v("-"+e._s(e.secondsToPlayback(e.localremaining)))])])])]),e._v(" "),l("div",{staticClass:"flex items-center w-full justify-evenly my-5"},[l("div",{},[l("span",{staticClass:"fa-layers fa-fw fa-3x relative",on:{click:e.seekBackwards}},[l("i",{staticClass:"fa-thin fa-circle-notch fa-rotate-by",staticStyle:{"--fa-rotate-angle":"-23deg"}}),e._v(" "),l("i",{staticClass:"fa-solid fa-chevron-left",staticStyle:{"font-size":"12px"},attrs:{"data-fa-transform":"up-30"}}),e._v(" "),l("span",{staticClass:"text-sm absolute inset-0 flex justify-center items-center"},[e._v("30")])])]),e._v(" "),l("div",{staticClass:"cursor-pointer relative"},[l("span",{directives:[{name:"show",rawName:"v-show",value:!e.playing,expression:"!playing"}],staticClass:"fa-layers fa-fw fa-6x",on:{click:e.togglePlay}},[l("i",{staticClass:"fa-solid fa-circle text-gray-600"}),e._v(" "),l("i",{staticClass:"fa-inverse fa-solid fa-play",attrs:{"data-fa-transform":"shrink-10"}})]),e._v(" "),l("span",{directives:[{name:"show",rawName:"v-show",value:e.playing,expression:"playing"}],staticClass:"fa-layers fa-fw fa-6x",on:{click:e.togglePlay}},[l("i",{staticClass:"fa-solid fa-circle text-gray-600"}),e._v(" "),l("i",{staticClass:"fa-inverse fa-solid fa-pause",attrs:{"data-fa-transform":"shrink-10"}})]),e._v(" "),l("span",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"fa-layers fa-fw fa-6x absolute inset-0 opacity-70",on:{click:e.togglePlay}},[l("i",{staticClass:"fa-solid fa-circle text-gray-600"}),e._v(" "),l("i",{staticClass:"fa-inverse fa-light fa-spinner-third fa-spin",attrs:{"data-fa-transform":"shrink-2"}})])]),e._v(" "),l("div",{},[l("span",{staticClass:"fa-layers fa-fw fa-3x relative",on:{click:e.seekForwards}},[l("i",{staticClass:"fa-thin fa-arrow-rotate-right fa-rotate-by",staticStyle:{"--fa-rotate-angle":"23deg"}}),e._v(" "),l("span",{staticClass:"text-sm absolute inset-0 flex justify-center items-center"},[e._v("45")])])])]),e._v(" "),l("div",{staticClass:"p-5 w-full"},[l("div",{staticClass:"bg-gray-200 rounded p-3 px-6 w-full relative flex justify-between"},[l("button",{staticClass:"cursor-pointer",on:{click:function(t){e.editPlaybackSpeed=!0}}},[e._v(e._s(e.playbackSpeed)+"x")]),e._v(" "),e._m(0),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),e.editPlaybackSpeed?l("div",{staticClass:"absolute inset-0 flex bg-gray-200 rounded justify-between p-3 px-6"},[l("span",[e._v(e._s(e.playbackSpeed)+"x")]),e._v(" "),l("div",{staticClass:"flex items-center"},[l("div",{staticClass:"mx-3 cursor-pointer",on:{click:e.decreasePlaybackSpeed}},[l("i",{staticClass:"fa-solid fa-circle-minus text-gray-600 fa-lg"})]),e._v(" "),l("div",[l("input",{staticClass:"w-12 p-2 text-center",domProps:{value:e.playbackSpeed},on:{input:e.updatePlaybackSpeed}})]),e._v(" "),l("div",{staticClass:"mx-3 cursor-pointer",on:{click:e.increasePlaybackSpeed}},[l("i",{staticClass:"fa-solid fa-circle-plus text-gray-600 fa-lg"})])]),e._v(" "),l("div",{staticClass:"cursor-pointer",on:{click:function(t){e.editPlaybackSpeed=!1}}},[e._v("Close")])]):e._e()])])])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"cursor-pointer"},[t("i",{staticClass:"fa-thin fa-alarm-snooze"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"cursor-pointer"},[t("i",{staticClass:"fa-thin fa-airplay"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"cursor-pointer"},[t("i",{staticClass:"fa-thin fa-sliders-up"})])}],!1,null,null,null);t.default=component.exports}}]);